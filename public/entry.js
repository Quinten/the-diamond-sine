M=Math,P=M.PI,h=location,u=24,U=u*u,v=u/2,q=M.sqrt(v*v*2),Q=-q/2,b.style.background="#334",c.fillStyle="#eff",c.translate((a.width-U)/2,(a.height-U)/2),T=c.fillRect.bind(c),R=c.rotate.bind(c),g=[u=>u,p=>T(-v,-v,u-1,u-1),u=>[c.beginPath(),c.arc(0,0,v-1,0,2*P),c.fill()],u=>[R(P/4),T(Q,Q,q,q)],u=>[R(P/4),T(Q,Q/3,q,q/3),R(P/2),T(Q,Q/3,q,q/3)]],m=u=>(p=1e4*M.sin(u++))=>p*p%1,$=Number(h.hash.slice(1))||1,z=o=>{for(r=m(h.hash=$),s=r()*U|0,p=[];p.length<U;)p.push(p.length==s?4:p.length==s-u||r()>.1+.08*$?1:4*r()|0);f()},H=0,E=(o,r)=>{setTimeout(n=>{H>=U?(H=0,$+=r,z()):(p=p.map(o),H+=u,f())},u)},f=f=>{for(c.clearRect(-1,-1,U+2,U+2),y=0;y<U;){for(x=0;x<u;){for(o=y+x;2==p[y+x]&&2==p[o]&&(0==p[o+u]||2==p[o+u]);)0==p[o+u]&&(p[y+x]=0),o+=u,p[o]=2,4!=p[o+u]&&3!=p[o+u]||(p[o+u]=0);c.save(),c.translate(x*u+u/2,y+u/2),g[p[y+x]](),c.restore(),x+=1}y+=u}-1==p.indexOf(4)?E((u,p)=>p<H&&r()>.6?0:u,0):-1==p.indexOf(3)&&E(u=>3*r()|0||4,1)},z(),onkeyup=o=>{w=[-1,-1,u,0,1,-1,-u,1,u,-u][o.which%32%17],n=s+w,k=((s/u|0)-(n/u|0))*u*(w*w%u),n=(n+U+k)%U,(p[n]%2||0==p[n])&&(p[s]=0,s=n,p[s]=4,f())};