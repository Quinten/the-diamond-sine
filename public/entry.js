u=24,uu=u*u,v=u/2,vv=v*v,q=Math.sqrt(2*vv),b.style.background="#334",c.fillStyle="#eff",c.translate((a.width-uu)/2,(a.height-uu)/2),P=Math.PI,V=c.fillRect.bind(c),R=c.rotate.bind(c),g=[u=>u,p=>V(-v,-v,u-1,u-1),u=>[c.beginPath(),c.arc(0,0,v-1,0,2*P),c.fill()],u=>[R(P/4),V(-q/2,-q/2,q,q)],u=>[R(P/4),V(-q/2,-q/6,q,q/3),R(P/2),V(-q/2,-q/6,q,q/3)]],m=u=>(p=1e4*Math.sin(u++))=>p*p%1,$=1,z=u=>{for(r=m($),s=r()*uu|0,p=[];p.length<uu;)p.push(p.length==s?4:r()>.4?1:4*r()|0);f()},E=(u,o,q)=>{-1==p.indexOf(u)&&setTimeout(u=>{alert(o),$+=q,z()},5)},f=q=>{for(c.clearRect(-1,-1,uu+2,uu+2),y=0;y<uu;){for(x=0;x<u;){for(o=y+x;2==p[y+x]&&2==p[o]&&(0==p[o+u]||2==p[o+u]);)0==p[o+u]&&(p[y+x]=0),o+=u,p[o]=2,4!=p[o+u]&&3!=p[o+u]||(p[o+u]=0);c.save(),c.translate(x*u+u/2,y+u/2),g[p[y+x]](),c.restore(),x+=1}y+=u}E(4,"RIP",0),E(3,"LVL "+$+" OK",1)},z(),onkeyup=o=>{w=[-1,-1,u,0,1,-1,-u,1,u,-u][o.which%32%17],n=s+w,k=((s/u|0)-(n/u|0))*u*(w*w%u),n=(n+uu+k)%uu,(p[n]%2||0==p[n])&&(p[s]=0,s=n,p[s]=4,f())};