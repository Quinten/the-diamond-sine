<!doctype html>
<head>
    <title>Title ~ js1024</title>
    <meta name="author" content="Author"></meta>
    <meta name="description" content="Short description"></meta>
    <meta name="title" content="Title"></meta>
    <meta charset=utf-8>
</head>
<body id=b>
<canvas id=a></canvas>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
#a { position: relative; display: block; }
.play { position: fixed; top: 50%; left: 50%; transform: translateX(-50%)translateY(-50%); font-size: 30px; font-family: arial, sans-serif; background: #f3f4f5; padding: 15px; border: 2px solid #ddd; border-radius: 5px; }
</style>

<script>

// Entry configuration
// ===================

var title = "Title"; // this will be assigned automatically

// Shim setup and polyfills (do not edit)
// ======================================

// canvas automatically adjusted !
a.width = innerWidth;
a.height = innerHeight;

c = a.getContext("2d"); // no more $type conditional

d = document;
window.AudioContext = window.AudioContext || window.webkitAudioContext;
window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
a.requestPointerLock = a.requestPointerLock || a.mozRequestPointerLock || a.webkitRequestPointerLock;
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
if (typeof OscillatorNode !== 'undefined' && OscillatorNode.prototype) {
  OscillatorNode.prototype.start = OscillatorNode.prototype.start || OscillatorNode.prototype.noteOn;
  OscillatorNode.prototype.stop = OscillatorNode.prototype.stop || OscillatorNode.prototype.noteOff;
}

// Add a start button if sound is present in the code
onload = () => {
  var entry_code = entry.innerText;
  var has_sound = false;
  if(entry_code.includes('eval')){
    try {
      eval(entry_code.replace(/eval\(/g, 'throw(').replace(/eval\`/g, 'throw`'));
    }
    catch(e){
      entry_code = e;
    }
  }
  if(entry_code.includes("AudioContext")||entry_code.includes("Oscillator")||entry_code.includes("speak")||entry_code.includes("play")||entry_code.includes("autoplay")){
    b.insertAdjacentHTML("beforeEnd", "<button class='play' onclick='console.log(entry.innerText);eval(entry.innerText);this.remove()'>PLAY</button>");
  }
  else {
    eval(entry.innerText);
  }
};
console.log(
  a, // canvas
  b, // body
  c, // 2D canvas context
  d  // document
);

</script>

<script type=text id=entry>
    u=24,uu=u*u,v=u/2,vv=v*v,q=Math.sqrt(2*vv),b.style.background="#000",c.fillStyle="#fff",c.translate((a.width-uu)/2,(a.height-uu)/2),P=Math.PI,V=c.fillRect.bind(c),R=c.rotate.bind(c),g=[u=>u,p=>V(-v,-v,u-1,u-1),u=>[c.beginPath(),c.arc(0,0,v-1,0,2*P),c.fill()],u=>[R(P/4),V(-q/2,-q/2,q,q)],u=>[R(P/4),V(-q/2,-q/6,q,q/3),R(P/2),V(-q/2,-q/6,q,q/3)]],m=u=>(p=1e4*Math.sin(u++))=>p*p%1,$=1,z=u=>{for(r=m($),s=r()*uu|0,p=[];p.length<uu;)p.push(p.length==s?4:r()>.4?1:4*r()|0);f()},f=q=>{for(c.clearRect(-1,-1,uu+2,uu+2),y=0;y<uu;){for(x=0;x<u;){for(o=y+x;2==p[y+x]&&2==p[o]&&(0==p[o+u]||2==p[o+u]);)0==p[o+u]&&(p[y+x]=0),o+=u,p[o]=2,4!=p[o+u]&&3!=p[o+u]||(p[o+u]=0);c.save(),c.translate(x*u+u/2,y+u/2),g[p[y+x]](),c.restore(),x+=1}y+=u}-1===p.indexOf(4)&&setTimeout(u=>{alert("ouch"),z()},40),-1===p.indexOf(3)&&setTimeout(u=>{alert("Lvl "+$+" ok"),$++,z()},40)},z(),onkeyup=o=>{w=[-1,-1,u,0,1,-1,-u,1,u,-u][o.which%32%17],n=(s+w+uu)%uu,(p[n]%2||0==p[n])&&(p[s]=0,s=n,p[s]=4,f())};
let html;
setInterval(() => {
    fetch('index.html').then(response => response.text()).then(newHtml => { if (html && newHtml != html) { location.reload(); }; html = newHtml; });
}, 1000);

</script>
</body>
